!function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="../",i(i.s=2)}({2:function(e,t){new class{constructor(){this.video1=document.getElementById("video1"),this.broadcasterList=document.getElementById("broadcasters"),this.ws=new WebSocket("wss://10.202.83.23:3002"),this.viewerId=window.location.pathname.split("/")[2],this.pc=new RTCPeerConnection({iceServers:[{urls:"turn:10.202.83.23",username:"webrtc",credential:"turnserver"}]}),this.target,this.init()}init(){console.log("tuna"),this.pc=this.createPc.call(this),this.ws.onopen=()=>{this.ws.send(JSON.stringify({action:"init viewer",viewerId:this.viewerId}))},this.ws.onmessage=e=>{let t=JSON.parse(e.data);if("recieved broadcasters"==t.action){let e="";t.broadcasters.forEach(t=>{e+="<a data-streamerId='"+t+"'>"+t+"</a>"}),this.broadcasterList.innerHTML=e,document.querySelectorAll("#broadcasters > a").forEach(e=>{e.onclick=this.getStream.bind(this)})}if("send broadcast"==t.action){console.log(t.returnedDescription);let e=new RTCSessionDescription(t.returnedDescription);this.pc.setRemoteDescription(e).then(()=>this.pc.createAnswer()).then(e=>this.pc.setLocalDescription(e)).then(()=>{this.ws.send(JSON.stringify({action:"send answer",target:this.target,viewerId:this.viewerId,description:this.pc.localDescription}))})}if("new-ice-candidate"==t.action){var i=new RTCIceCandidate(e.candidate);console.log("*** Adding received ICE candidate: "+JSON.stringify(e.candidate)),this.pc.addIceCandidate({target:e.target,candidate:i})}}}createPc(){let e=new RTCPeerConnection({iceServers:[{urls:"turn:10.202.83.23",username:"webrtc",credential:"turnserver"}]});return e.onicecandidate=({candidate:e})=>{console.log("ice"),console.log(e),this.ws.send(JSON.stringify({action:"new-ice-candidate",target:this.target,viewerId:this.viewerId,type:"viewer",candidate:e}))},e.ontrack=e=>{console.log(e.streams[0]),console.log(this.video1),this.video1.srcObject=e.streams[0]},e}getStream(e){this.target=e.currentTarget.dataset.streamerid,console.log("add viewer"),"checking"!=this.pc.iceConnectionState&&"connected"!=this.pc.iceConnectionState&&"completed"!=this.pc.iceConnectionState||(this.pc.getTransceivers().forEach(e=>{e.stop()}),this.pc.close(),this.pc=null),this.pc=this.createPc.call(this),this.ws.send(JSON.stringify({action:"remove viewer",viewerId:this.viewerId})),this.ws.send(JSON.stringify({action:"add viewer",streamerId:e.currentTarget.dataset.streamerid,viewerId:this.viewerId}))}}}});
//# sourceMappingURL=viewer.5e58be4e.js.map