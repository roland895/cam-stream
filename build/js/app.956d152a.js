!function(e){var t={};function i(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(o,r,function(t){return e[t]}.bind(null,r));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="../",i(i.s=0)}([function(e,t,i){"use strict";i.r(t);i(1);new class{constructor(){this.getBluetoothButton=document.getElementById("get_bluetooth_device"),this.bluetoothDeviceList=document.getElementById("bluetooth_devices"),this.recordButton=document.getElementById("record"),this.endButton=document.getElementById("stop"),this.video=document.querySelector("video"),this.ws=new WebSocket("wss://10.202.83.23:3002"),this.userId=window.location.pathname.split("/")[2],this.stream,this.recordedBlobs,this.mediaRecorder,this.interval,this.videoTracks,this.audioTracks,this.target,this.pc=new RTCPeerConnection({iceServers:[{urls:"turn:10.202.83.23",username:"webrtc",credential:"turnserver"}]}),this.peerConnections=[],this.init.call(this)}init(){this.getBluetoothButton.onclick=this.getBluetooth,navigator.mediaDevices.getUserMedia({video:{width:1280,height:720},audio:!0}).then(e=>{this.video.srcObject=e,window.stream=e,this.stream=e}),this.ws.onmessage=e=>{let t=JSON.parse(e.data);if("make pc"==t.action){let e=this.createPeerConnection.call(this,t.viewerId);e.viewerId=t.viewerId,this.stream.getTracks().forEach(t=>e.addTrack(t,stream)),e.createOffer({offerToReceiveAudio:1,offerToReceiveVideo:1}).then(t=>e.setLocalDescription(t)).then(()=>{this.ws.send(JSON.stringify({action:"send description to viewer",streamerId:this.userId,viewerId:t.viewerId,description:e.localDescription}))}),this.peerConnections.push(e)}if("recieved answer"==t.action){let e=new RTCSessionDescription(t.description);this.peerConnections.forEach(i=>{i.viewerId===t.viewerId&&i.setRemoteDescription(e).then({})})}"new-ice-candidate"==t.action&&this.peerConnections.forEach(e=>{console.log("New ice"),e.viewerId===t.viewerId&&(console.log(t.candidate),e.addIceCandidate(t.candidate))})},this.recordButton.onclick=this.record.bind(this),this.endButton.onclick=this.stopRecording.bind(this)}createPeerConnection(e){let t=new RTCPeerConnection({iceServers:[{urls:"turn:10.202.83.23",username:"webrtc",credential:"turnserver"}]});return this.pc.onicecandidate=t=>{console.log("on"),console.log(t),this.ws.send(JSON.stringify({action:"new-ice-candidate",target:e,type:"broadcaster",candidate:t.candidate}))},t}record(){this.recordedBlobs=[];let e={mimeType:"video/webm;codecs=vp9"};MediaRecorder.isTypeSupported(e.mimeType)||(console.error(`${e.mimeType} is not Supported`),e={mimeType:"video/webm;codecs=vp8"},MediaRecorder.isTypeSupported(e.mimeType)||(console.error(`${e.mimeType} is not Supported`),e={mimeType:"video/webm"},MediaRecorder.isTypeSupported(e.mimeType)||(console.error(`${e.mimeType} is not Supported`),e={mimeType:""})));try{this.mediaRecorder=new MediaRecorder(window.stream,e)}catch(e){return void console.error("Exception while creating MediaRecorder:",e)}this.mediaRecorder.onstop=e=>{console.log("Recorder stopped: ",e)},this.mediaRecorder.ondataavailable=this.handleDataAvailable.bind(this),this.mediaRecorder.start(1e3),1===this.ws.readyState&&this.ws.send(JSON.stringify({action:"start",userId:this.userId}))}stopRecording(){clearInterval(this.clearInterval),this.ws.send(JSON.stringify({action:"stop",userId:this.userId}))}handleDataAvailable(e){e.data&&e.data.size>0&&this.recordedBlobs.push(e.data)}getFrame(){const e=document.createElement("canvas");return e.width=this.video.videoWidth,e.height=this.video.videoHeight,e.getContext("2d").drawImage(this.video,0,0),e.toDataURL("image/png")}getBluetooth(){fetch("/getbluetooth",{method:"POST",headers:{"Content-Type":"application/json"}}).then(e=>(console.log(e),e.json())).then(e=>{console.log(e),this.bluetoothDeviceList.innerHTML=e[0].tuna})}}},function(e,t,i){}]);
//# sourceMappingURL=app.956d152a.js.map